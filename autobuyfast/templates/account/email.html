
{% extends "account/base.html" %}

{% load i18n %}
{% load crispy_forms_tags %}

{% block head_title %}{% trans "Account" %}{% endblock %}

{% block inner %}
    <!-- Action buttons -->

    <div class="col-md-2">
      {% if request.user.username %}
      <a class="btn btn-primary btn-block" href="{% url 'users:detail' request.user.username %}" role="button">Dashboard</a>
      <a class="btn btn-primary btn-block" href="{% url 'account_email' %}" role="button">Saved Cars</a>
      <a class="btn btn-primary btn-block" href="{% url 'account_email' %}" role="button">Saved Search</a>
      <a class="btn btn-primary btn-block" href="{% url 'account_email' %}" role="button">Update E-Mail</a>
      <a class="btn btn-primary btn-block" href="{% url 'users:update' %}" role="button">Profile</a>
      <a class="btn btn-primary btn-block" href="{% url 'account_email' %}" role="button">Account Settings</a>
      {% if request.user.is_seller %}
      <a class="btn btn-primary btn-block" href="{% url 'account_email' %}" role="button">Manage Ads</a>
      {% endif %}
      <!-- Your Stuff: Custom user template urls -->
      <a class="btn btn-primary btn-block" href="{% url 'account_logout' %}" role="button">Logout</a>
      {% endif %}
    </div>

    <!-- End Action buttons -->
    <div class="col-md-10">
      <section class="b-car-details">
        <div class="b-car-details__header">
          <h2 class="b-car-details__title">Email Settings</h2>
          <div class="b-car-details__subtitle">Set and add a default or primary email</div>
          <div class="b-car-details__address"><i class="icon fa fa-map-marker text-primary"></i> {% if request.user.userprofile.address %} {{ request.user.userprofile.address }} {% else %} <a href="{% url 'users:update' %}">Update Your Address</a> {% endif %}</div>
          <div class="b-car-details__links">
            <!-- <a class="b-car-details__link" href="car-details.html"><i class="icon fa fa-exchange text-primary"></i> Add to Compare</a> -->
            <a class="b-car-details__link" href="{% url 'cars:list' %}"><i class="icon fa fa-car text-primary"></i> Car Brochure</a>
            <!-- <a class="b-car-details__link" href="car-details.html"><i class="icon fa fa-share-alt text-primary"></i> Share</a> -->
          </div>
        </div>
      </section>

      <div class="b-car-details__section">
        <h4>{% trans "E-mail Addresses" %}</h4>

        {% if user.emailaddress_set.all %}
        <p>{% trans 'The following e-mail addresses are associated with your account:' %}</p>

        <form action="{% url 'account_email' %}" class="email_list" method="post">
        {% csrf_token %}
        <fieldset class="blockLabels">

          {% for emailaddress in user.emailaddress_set.all %}
        <div class="radio">
          <label for="email_radio_{{forloop.counter}}" class="{% if emailaddress.primary %}primary_email{%endif%}">

            <input id="email_radio_{{forloop.counter}}" type="radio" name="email" {% if emailaddress.primary or user.emailaddress_set.count == 1 %}checked="checked"{%endif %} value="{{emailaddress.email}}"/>

            {{ emailaddress.email }}
            {% if emailaddress.verified %}
            <sup class="verified" style="font-weight:600; color: green; margin-left: 15px;">{% trans "Verified" %}</sup>
            {% else %}
            <sup class="unverified" style="font-weight:600; color: red; margin-left: 15px;">{% trans "Unverified" %}</sup>
            {% endif %}
            {% if emailaddress.primary %}<sup class="primary text-primary font-weight-bolder">{% trans "Primary" %}</sup>{% endif %}
          </label>
        </div>
          {% endfor %}

        <div class="form-group">
              <button class="secondaryAction btn btn-primary" type="submit" name="action_primary" >{% trans 'Make Primary' %}</button>
              <button class="secondaryAction btn btn-success" type="submit" name="action_send" >{% trans 'Re-send Verification' %}</button>
              <button class="primaryAction btn btn-default" type="submit" name="action_remove" >{% trans 'Remove' %}</button>
        </div>

        </fieldset>
        </form>

        {% else %}
        <p><strong>{% trans 'Warning:'%}</strong> {% trans "You currently do not have any e-mail address set up. You should really add an e-mail address so you can receive notifications, reset your password, etc." %}</p>

        {% endif %}


            <h4>{% trans "Add E-mail Address" %}</h4>

            <form method="post" action="{% url 'account_email' %}" class="add_email">
                {% csrf_token %}
                {{ form|crispy }}
                <button class="btn btn-primary btn-block" name="action_add" type="submit">{% trans "Add E-mail" %}</button>
            </form>

    </div>
  </div>

{% endblock %}


{% block inline_javascript %}
{{ block.super }}
<script type="text/javascript">
window.addEventListener('DOMContentLoaded',function() {
  const message = "{% trans 'Do you really want to remove the selected e-mail address?' %}";
  const actions = document.getElementsByName('action_remove');
  if (actions.length) {
    actions[0].addEventListener("click", function(e) {
      if (!confirm(message)) {
        e.preventDefault();
      }
    });
  }
});

document.addEventListener('DOMContentLoaded', function() {
  $('.form-group').removeClass('row');
})
</script>
{% endblock %}
